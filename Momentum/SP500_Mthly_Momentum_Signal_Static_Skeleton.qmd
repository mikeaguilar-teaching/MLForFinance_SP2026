---
title: "Momentum Signal"
subtitle: "Constructing and evaluating a static momentum signal"
author: Mike Aguilar | https://www.linkedin.com/in/mike-aguilar-econ/ 
format: html
editor: visual
toc: true
toc-depth: 5
toc-location: left
embed-resources: true
execute: 
  warning: false
  echo: true
---

# Housekeeping

```{r}
#| echo: false
cat("\014")  # clear console
rm(list=ls())  # Clear the workspace
if (!requireNamespace("here", quietly = TRUE)) install.packages("here")
suppressPackageStartupMessages(library(here))
source(here("Supporting", "PackageLoads.R"))

```

# Data

## Load simple returns

Task: Load SP500-Monthly Simple Returns

```{r}
Returns <- read.csv(?("Data","SP500_Mthly_SimpleReturns.csv"))
```

## Load monthly momentum from GitHub

```{r}
Momentum <- read.csv(?("Data","SP500_Mthly_Momentum.csv"))
```

## Merge

Task: Merge the returns and momentum, retaining only those dates with complete information

```{r}
merged_df <- Returns %>%
  left_join(Momentum, by = c("?", "ticker"))

```

## Set Test and Train Periods

Task: Create a dataframe for the Train period which spans the beginning of the dataset to Aug2025. Call this dataframe Test. Create a dataframe for the Train period which is Sep2025 period. Call this dataframe Train.

```{r}

test_date <- as.Date("2025-09-30") 
last_train_date <- as.Date(
  format(test_date, "%Y-%m-01")  ) - 1

Train <- merged_df %>% filter(Date ? test_date)
Train.Returns  <- Train %>% select(!momentum)
Train.Momentum <- Train %>% select(!OneMthSimpleRet)

Test <- merged_df %>% filter(Date ? test_date)
Test.Returns  <- Test %>% select(!momentum)
Test.Momentum <- Test %>% select(!OneMthSimpleRet)

```

## Isolate Index and Constituents

Task: Isolate the returns for the index and the group of constituents into separate dataframes. Repeat for momentum.

```{r}
Train.Constituents <- Train %>%
  filter(!ticker == ?)
Train.Returns.Index <- Train.Returns %>%
  filter(ticker == ?)
Train.Returns.Constituents <- Train.Returns %>%
  filter(? == "SP500")
Train.Momentum.Index <- Train.Momentum %>%
  filter(? == "SP500")
Train.Momentum.Constituents <- Train.Momentum %>%
  filter(? == "SP500")

Test.Constituents <- Test %>%
  filter(!ticker == "SP500")
Test.Returns.Index <- Test.Returns %>%
  filter(ticker == "SP500")
Test.Returns.Constituents <- Test.Returns %>%
  filter(!ticker == "SP500")
Test.Momentum.Index <- Test.Momentum %>%
  filter(ticker == "SP500")
Test.Momentum.Constituents <- Test.Momentum %>%
  filter(!ticker == "SP500")

```

# Signal Construction

Task: Construct a simple momentum strategy

-   Define LongCondition = 1 if $mom^{Train}_{i} >0$ and 0 otherwise

-   Define ShortCondition = 1 if $mom^{Train}_{i} < 0$ and 0 otherwise

-   $s_{i,t}$ = LongCondition minus ShortCondition

Task: Create a dataframe that contains the momentum on the last observation of the training period

```{r}

Signal_Matrix <- Train.Momentum.Constituents %>% 
  filter(Date == last_train_date) %>%
  select(ticker, momentum) %>% 
  rename("signal_matrix" = "momentum")

Signal_Matrix
```

Task: Create a dataframe that takes +1,0,-1 based upon long, neutral, short positioning. Long if signal \> tau. Short if signal less than -tau. Neutral otherwise.

```{r}

tau <- 0

Signal_Position <- Signal_Matrix %>%
  transmute(
    ticker,
    signal = case_when(
      signal_matrix >  ?  ~  1L,
      signal_matrix < ?  ~ -1L,
      TRUE             ~  0L
    )
  ) %>%
  rename("signal_position" = "signal")

Signal_Position

# Note: the "L" tells R to store the +1,0,-1 as integers rather than numerics, which is more efficient for storage. 

```

Q: Why no 0s in the Signal_Position Matrix? 

A: 

- 



# Evaluate

Task: Format Test period returns to conform to the Signal Testing function

```{r}
test_returns <- Test.Returns.Constituents %>%
  ?(ticker,OneMthSimpleRet) %>%
  rename(test_returns = OneMthSimpleRet)
```

Task: Create meta labels

```{r}
 Meta <- list(
   assetname = "asset",
   signalname = "Momentum"
 )
```

Task: Implement the Signal Evaluation Static function

```{r}
return_threshold = 0

  SignalEval <- signal_evaluation_static(
    test_returns = ?,
    Meta = Meta,
    return_threshold = ?,
    signal_position = Signal_Position
  )
```

Q: What's the difference in meaning of tau and return_threshold? 

A: 



Q: What if set tau very large? What is the (dis)advantage?

A: 




Q: What if set return threshold very large? What is the (dis)advantage?

A: 



Task: Display the Trade results

```{r}
SignalEval$?
```

Q: Interpret the trade results. Can you comment on how active was the signal? Connect that to "coverage". 

A:



Q: Do you remember on what period are we testing? What is the frequency of the data? 

A: 



Task: Display the hit table

```{r}
SignalEval$?
```

Q: Interpret. Comment on the statistical significance. Why are the 2 columns of results the same? 

A:


Task: Display the Info Coefficient

```{r}
SignalEval$?
```

Q: Interpret. What is the difference in the conceptual meaning of Hit Rate and IC? Comment on the statistical significance. 

A:



Task: Display the confusion matrix. 

```{r}
SignalEval$?
```

Q: Interpret with a focus on Recall, Specificity, and Type 1 error for Longs and Shorts. Do we capture more of the upside or downside? Do we avoid more bad longs or bad shorts? Did we make more mistakes on the long or short side? 

A:


