---
title: "Portfolio Construction Demo"
subtitle: "Quick demo of the construct portfolio function"
author: Mike Aguilar | https://www.linkedin.com/in/mike-aguilar-econ/ 
format: html
editor: visual
toc: true
toc-depth: 5
toc-location: left
embed-resources: true
execute: 
  warning: false
  echo: true
---

# Housekeeping

```{r}

#| echo: false
#| warning: false

cat("\014")  # clear console
rm(list=ls())  # Clear the workspace
if (!requireNamespace("here", quietly = TRUE)) install.packages("here")
suppressPackageStartupMessages(library(here))
source(here("Supporting", "PackageLoads.R"))
```

# Data

Task: set seed 124 for simulations

```{r}
 set.seed(124)
```

Task: Create a sequence of letters starting from A and progressing by one letter increments for a total of N letters. These will represent your tickers

```{r}
N = 5
tickers<- LETTERS[1:N]
```

Task: Set the last date for the training period to 2023-01-31

```{r}
last_train_date <- as.Date("2023-01-31")
```

Task: create a weights_df dataframe with weights set to 1/N for each asset. The df should contain date, ticker, and weight columns. The date column should be set to last_train_date for all rows.

```{r}
weights_df <- data.frame(
  Date = last_train_date,
  ticker = tickers,
  weight = rep(1/N, N)
  #weight = c(.5,.25,.25,0,0) # e.g. for a $100 portfolio, the 0.5 is akin to $50 in asset A. We can say that is 0.5 notional exposure
)
```

Task: Create a sequence of 20 days after the last_train_date to represent the return dates

```{r}
return_dates <- seq.Date(from = last_train_date + 1, by = "day", length.out = 20)
return_dates
```

Task: create a returns_df dataframe with random normal returns for each ticker and return date. The df should contain date, ticker, and return columns.

```{r}
returns_df <- expand.grid(
  Date = return_dates,
  ticker = tickers
) %>%
  arrange(Date, ticker) %>%
  mutate(
    return = rnorm(nrow(.), mean = 0.0005, sd = 0.02)
  )
```

Task: Construct the portfolio

```{r}
Port <- construct_portfolio(
  return_df = returns_df,
  weight_df = weights_df,
  date_col   = "Date",
  ticker_col = "ticker",
  return_col = "return",
  weight_col = "weight",
  return_type = "simple",
  rebalance_freq = "monthly",
  shift_n = 1
)


```

Task: Display the holdings

```{r}
Port$holdings

```

Task: Display the portfolio returns

```{r}
Port$portfolio
```

Task: Plot the portfolio index over time

```{r}
ggplot(Port$portfolio, aes(x = date, y = port_index)) +
  geom_line(color = "blue") +
  labs(title = "Portfolio Index Over Time",
       x = "Date",
       y = "Portfolio Index") +
  theme_minimal()
```
